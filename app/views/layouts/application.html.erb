<!DOCTYPE html>
<html>
<head>
	<title>BuyBy</title>
	<%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
	<%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
	<%=favicon_link_tag%>
	<%= csrf_meta_tags %>
</head>
<body>
	<!-- Navigation -->
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<%=link_to BuyBy, portal_welcome_path, :class=>"navbar-brand"%>
			</div>
			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav navbar-right">
					<% if user_signed_in? %>
					<li>
						<a href="">
							Hi, <strong> <%= current_user.nickname %> </strong>.
						</a>
					</li>
					
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">
							<% unread_comments=current_user.received_comments.unread(current_user.id)%>
							<% my_offer_comments=current_user.received_gave_offer_comments.unread(current_user.id)%>
							<%unread_comments+=my_offer_comments%>
							<%if unread_comments.blank?%>
								<i class="fa fa-envelope fa-fw"></i>
							<%else%>
								<i message-number="<%=unread_comments.count%>" class="fa fa-envelope-o fa-fw unread-comment-notification"></i>
							<%end%>
							<i class="fa fa-caret-down"></i>
						</a>
						<ul class="dropdown-menu dropdown-messages">
							<li><small><%=t(:unread_reply)%>:</small></li>
							<%if unread_comments.blank?%>
							<li><a href=""><%=t(:empty_message)%>..</a></li>
							<br>
							<%else%>
							<%unread_comments.each do |comment|%>
							<li>
								<%= link_to comment.offer.request do%>
								<%=comment.user.nickname%>
								<small>(<span class="text-muted"> <%= comment.created_at.strftime("%-d %B %Y, %H:%M:%S") %></span>)</small> <br />
								<%= comment.content.truncate(20) %>
								<%end%>
							</li>
							<li class="divider"></li>
							<%end%>
							<%end%>
						</ul>
					</li>

					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">
							<% unread_offers=current_user.received_offers.unread%>
							<%if unread_offers.blank?%>
								<i class="fa fa-gavel fa-fw"></i>  
							<%else%>
								<i offer-number="<%=unread_offers.count%>" class="fa fa-gavel fa-fw unread-offer-notification"></i>
							<%end%>
							<i class="fa fa-caret-down"></i>
						</a>
						<ul class="dropdown-menu dropdown-messages">
							<li><small><%=t(:received_offers)%>:</small></li>
							<%if unread_offers.blank?%>
							<li><a href=""><%=t(:empty)%>..</a></li>
							<li class="divider"></li>
							<%else%>
							<%unread_offers.each do |offer|%>
							<li>
								<%= link_to request_path(offer.request,:read=>true) do%>
								<%=offer.subject%>
								<small>(<span class="text-muted"> <%= offer.created_at.strftime("%-d %B %Y, %H:%M:%S") %></span>)</small> <br />
								<%= offer.description.truncate(20) %>
								<%end%>
							</li>
							<li class="divider"></li>
							<%end%>
							<%end%>
							<li>
								<%= link_to t(:all_offers)+'..', offers_path%>
							</li>
						</ul>
					</li>
					
					<li class='dropdown'>
						<a class="dropdown-toggle" data-toggle="dropdown" href="#">
							<i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
						</a>
						<ul class="dropdown-menu dropdown-user">
							<li>
								<%= link_to edit_user_registration_path do %>
								<i class="fa fa-user fa-fw"></i> <%=t(:user_profile)%>
								<%end%>
							</li>
							<li class="divider"></li>
							<li>
								<%= link_to my_address_path do %>
								<i class="fa fa-map-marker fa-fw"></i><%=t(:my_address)%>
								<%end%>
							</li>
							<li class="divider"></li>
							<li>
								<%= link_to destroy_user_session_path, method: :delete do %>
								<i class="fa fa-sign-out fa-fw"></i> <%=t(:logout)%>
								<%end%>
							</li>
						</ul>
					</li>
					<% if is_admin?%>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">Management <b class="caret"></b></a>
						<ul class="dropdown-menu">

							<li>
								<%= link_to 'Requests Management', request_management_path%>
							</li>

							<li>
								<%= link_to 'Users Management', user_management_path%>
							</li>
							<li>
								<%= link_to 'Offers Management', offer_management_path%>
							</li>
							<li>
								<%= link_to 'Products Management', products_path%>
							</li>
							<li>
								<%= link_to 'Recommend Management', recommend_products_path%>
							</li>
						</ul>
					</li>
					<%end%>
					<% else %>
					<li>
						<%= link_to t(:login), new_user_session_path %>
					</li>
					<li>
						<%= link_to t(:signup), new_user_registration_path %>
					</li>
					<% end %>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
	</nav>
	<% flash.each do |key, value| %>
	<div class="alert alert-<%= key %>  alert-dismissable">
		<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
		<%= value %>
	</div>
	<% end %>
	<div class="col-xs-offset-1 col-xs-10">
		<%= yield %>
	</div>
</body>
</html>
